<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sistema</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <style>
        .user-menu .dropdown-menu { width: 280px; }
        .user-header { height: 170px; }
        .list-group-item-action { cursor: pointer; transition: 0.2s; }
        .modal-content { border-radius: 12px; border: none; }
        .user-image { object-fit: cover; }
        
        /* Previne o travamento da tela e scroll */
        body.modal-open { overflow: auto !important; padding-right: 0 !important; }

        /* Estilo da Notificação Toast */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
    </style>
</head>
<body class="bg-light">

    <div id="toast-container"></div>

    <nav class="app-header navbar navbar-expand bg-white border-bottom shadow-sm">
        <div class="container-fluid">
            <ul class="navbar-nav align-items-center">
                <li class="nav-item">
                    <a class="nav-link text-secondary" href="#" role="button"><i class="bi bi-list fs-4"></i></a>
                </li>
                <li class="nav-item d-none d-md-block">
                    <a href="#" class="nav-link fw-semibold text-secondary"><i class="bi bi-house-door me-1"></i> Início</a>
                </li>
            </ul>

            <ul class="navbar-nav ms-auto align-items-center">
                <li class="nav-item dropdown user-menu">
                    <a href="#" class="nav-link dropdown-toggle d-flex align-items-center" data-bs-toggle="dropdown">
                        <img id="nav-user-img" src="https://api.dicebear.com/9.x/pixel-art/svg?seed=Brian" 
                             class="user-image rounded-circle shadow-sm border" style="width: 32px; height: 32px;">
                        <span id="nav-user-name" class="d-none d-md-inline ms-2 fw-semibold text-dark">Brian</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-lg dropdown-menu-end border-0 shadow">
                        <li id="user-header-bg" class="user-header bg-primary text-white text-center p-4 rounded-top">
                            <img id="dropdown-user-img" src="https://api.dicebear.com/9.x/pixel-art/svg?seed=Brian" 
                                 class="rounded-circle shadow mb-2" style="width: 80px;">
                            <p id="dropdown-user-info" class="mb-0 fw-bold">
                                Brian Arrascaeta
                                <small class="d-block fw-light opacity-75">Web Developer</small>
                            </p>
                        </li>
                        <li><a href="#" class="dropdown-item py-2" data-bs-toggle="modal" data-bs-target="#modalTrocarUsuario"><i class="bi bi-people me-2 text-info"></i> Mudar de Usuário</a></li>
                        <li><a href="#" class="dropdown-item py-2" data-bs-toggle="modal" data-bs-target="#modalNovoUsuario"><i class="bi bi-person-plus me-2 text-success"></i> Cadastrar Novo</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a href="#" class="dropdown-item py-2 text-danger fw-bold" data-bs-toggle="modal" data-bs-target="#modalSair"><i class="bi bi-box-arrow-right me-2"></i> Sair</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </nav>

    <div class="modal fade" id="modalTrocarUsuario" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content shadow-lg">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">Alternar Conta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="list-group list-group-flush">
                        <button class="list-group-item list-group-item-action d-flex align-items-center py-3" 
                                onclick="trocarUsuario('Brian Arrascaeta', 'Web Developer', 'https://api.dicebear.com/9.x/pixel-art/svg?seed=Brian')">
                            <img src="https://api.dicebear.com/9.x/pixel-art/svg?seed=Brian" class="rounded-circle me-3" width="40">
                            <div><h6 class="mb-0 fw-bold">Brian Arrascaeta</h6><small class="text-muted">admin@sistema.com</small></div>
                        </button>
                        <button class="list-group-item list-group-item-action d-flex align-items-center py-3" 
                                onclick="trocarUsuario('Athos', 'System Architect', 'https://api.dicebear.com/9.x/pixel-art/svg?seed=Athos')">
                            <img src="https://api.dicebear.com/9.x/pixel-art/svg?seed=Athos" class="rounded-circle me-3" width="40">
                            <div><h6 class="mb-0 fw-bold">Athos</h6><small class="text-muted">athos@sistema.com</small></div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalNovoUsuario" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content shadow-lg">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title fw-bold">Novo Cadastro</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form id="formCadastro">
                    <div class="modal-body p-4">
                        <div class="mb-3">
                            <label class="form-label small fw-bold">NOME</label>
                            <input type="text" class="form-control" required>
                        </div>
                    </div>
                    <div class="modal-footer bg-light">
                        <button type="submit" class="btn btn-success px-4">Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalSair" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content shadow text-center">
                <div class="modal-body p-4">
                    <i class="bi bi-box-arrow-right text-danger fs-1 mb-3"></i>
                    <h5 class="fw-bold">Sair?</h5>
                    <div class="d-grid gap-2 mt-3">
                        <button type="button" class="btn btn-danger" onclick="logout()">Sim, Sair</button>
                        <button type="button" class="btn btn-light border" data-bs-dismiss="modal">Voltar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function mostrarAviso(msg, cor = "primary") {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `alert alert-${cor} shadow-lg border-0 d-flex align-items-center mb-2`;
            toast.style.animation = "fadeInDown 0.5s";
            toast.innerHTML = `<i class="bi bi-info-circle-fill me-2"></i> ${msg}`;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

        function limparModais() {
            document.body.classList.remove('modal-open');
            document.body.style.overflow = '';
            document.body.style.paddingRight = '';
            document.querySelectorAll('.modal-backdrop').forEach(b => b.remove());
        }

        function trocarUsuario(nome, cargo, img) {
            const usuario = { nome, cargo, img };
            localStorage.setItem('user_session', JSON.stringify(usuario));
            aplicarDadosUsuario(usuario);
            
            const modalElement = document.getElementById('modalTrocarUsuario');
            const modalInstance = bootstrap.Modal.getInstance(modalElement) || new bootstrap.Modal(modalElement);
            modalInstance.hide();

            setTimeout(() => {
                limparModais();
                mostrarAviso(`Usuário alterado para: <b>${nome}</b>`, "info");
            }, 150);
        }

        function aplicarDadosUsuario(user) {
            if (!user) return;
            document.getElementById('nav-user-name').innerText = user.nome.split(' ')[0];
            document.getElementById('nav-user-img').src = user.img;
            document.getElementById('dropdown-user-img').src = user.img;
            document.getElementById('dropdown-user-info').innerHTML = `
                ${user.nome} <small class="d-block fw-light opacity-75">${user.cargo}</small>
            `;
        }

        function logout() {
            localStorage.removeItem('user_session');
            limparModais();
            window.location.reload();
        }

        window.onload = () => {
            const salvo = localStorage.getItem('user_session');
            if (salvo) aplicarDadosUsuario(JSON.parse(salvo));
        };

        document.getElementById('formCadastro').addEventListener('submit', (e) => {
            e.preventDefault();
            mostrarAviso("Usuário cadastrado com sucesso!", "success");
            bootstrap.Modal.getInstance(document.getElementById('modalNovoUsuario')).hide();
            setTimeout(limparModais, 150);
        });
    </script>

    <style>
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</body>
</html>